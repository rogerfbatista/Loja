npm init

criar servidor http e debug

 npm install http express debug --save


 configuar o arquivo para start o servidor

  "start": "node bin\\Server.js"
  npm start

  instalar nodemon gerenciar o servidor modo desenvolvimento

  npm install nodemon --save-dev

  
  
   
 IF OBJECT_ID('tempdb..#TMP') IS NOT NULL
    DROP TABLE #TMP

	IF OBJECT_ID('tempdb..#TMP2') IS NOT NULL
    DROP TABLE #TMP2

CREATE TABLE #TMP(FLUXO INT, HORARIO DATETIME,INTERVALO VARCHAR(MAX));

 INSERT INTO #TMP VALUES(1,'20190702 20:25:00:00',NULL);
 
 INSERT INTO #TMP VALUES (1,'20190702 20:30:00:00',NULL);
				
 INSERT INTO #TMP VALUES(1,'20190702 20:35:00:00',NULL);

  INSERT INTO #TMP VALUES(1,'20190702 21:01:00:00',NULL);

  INSERT INTO #TMP VALUES(1,'20190702 21:04:00:00',NULL);

  
  INSERT INTO #TMP VALUES(1,'20190702 22:04:00:00',NULL);
  
  INSERT INTO #TMP VALUES(1,'20190702 23:04:00:00',NULL);

    INSERT INTO #TMP VALUES(1,'20190702 23:11:00:00',NULL);


WITH CTE as (
  SELECT 
    RN = ROW_NUMBER() OVER (ORDER BY FLUXO),
    * 
  FROM  #TMP 
)
SELECT
 -- [Previous Row].*,
  [Current Row].RN AS RN_CURRENT,
  [Current Row].FLUXO AS FLUXO_CURRENT,
  [Current Row].HORARIO AS HORARIO_CURRENT,
  [Next Row].*
  INTO #TMP2
FROM CTE [Current Row]
--LEFT JOIN CTE [Previous Row] ON 
--  [Previous Row].RN = [Current Row].RN - 1
LEFT JOIN CTE [Next Row] ON 
  [Next Row].RN = [Current Row].RN + 1


 DECLARE 
        @RN_CURRENT int,
        @FLUXO int,
		@HORARIO_CURRENT DATETIME,
		@HORARIO DATETIME,
		@INTERVALO VARCHAR(MAX),
		@CONTADOR INT =0

		 DECLARE CUR_SOR SCROLL  CURSOR
  FOR SELECT RN_CURRENT,FLUXO,HORARIO_CURRENT,HORARIO,INTERVALO FROM #TMP2

  OPEN  CUR_SOR

  
  FETCH NEXT FROM CUR_SOR
  INTO  @RN_CURRENT,
        @FLUXO ,
		@HORARIO_CURRENT ,
		@HORARIO ,
		@INTERVALO  


  --INTERAGIR ENTRE OS DADOS
    WHILE @@FETCH_STATUS = 0 
    BEGIN
		
		 SET  @CONTADOR = @CONTADOR + 1
		 SET @INTERVALO = 0

		 DECLARE @H_C INT
		  SET  @H_C= CONVERT(VARCHAR(2), CAST(@HORARIO_CURRENT AS TIME))
		  PRINT CONVERT(VARCHAR(MAX), @H_C) +' CURRENT' 

		   DECLARE @H INT
		  SET  @H= CONVERT(VARCHAR(2), CAST(@HORARIO AS TIME))
		  PRINT CONVERT(VARCHAR(MAX), @H )+ ' NEXT' 

		  IF (@H_C = @H)
	     SET @INTERVALO = (DATEDIFF(MINUTE,@HORARIO_CURRENT,@HORARIO));
	   
     SELECT  @RN_CURRENT,
        @FLUXO ,
		@HORARIO_CURRENT ,
		@HORARIO ,
		@INTERVALO AS INTERVALO,
	    @CONTADOR AS CONTADOR

  FETCH NEXT FROM CUR_SOR
  INTO  @RN_CURRENT,
        @FLUXO ,
		@HORARIO_CURRENT ,
		@HORARIO ,
		@INTERVALO        


   END
 

  --FECHAR CURSOR
  CLOSE CUR_SOR
  DEALLOCATE CUR_SOR 
 
 --  SELECT * FROM #TMP2

